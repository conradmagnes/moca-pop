# MOCAP-POPY: MOtion CAPture Pipeline Operations (using) PYthon

## Description
This repository contains python scripts for processing MoCap data.

## Installation

Clone this repo and install it as a package using pip. Installing the package will also install its dependencies.

```bash
git clone git@github.com:conradmagnes/mocap_popy.git

cd mocap_popy
python -m pip install .

# to install in editable mode, use the following command
python -m pip install -e .

# to install optional test dependencies, use the following command
python -m pip install .[test]
# in zsh, escape the brackets using
python -m pip install .\[test\]
```

### Additional Dependencies

This library also requires the Vicon Nexus API, if running scripts in 'online' mode. The Vicon Nexus API is automatically downloaded with newer versions (>=2.12) of the Vicon Nexus software. Locate the library in Program Files (either Program or Program Files (x86)) under Vicon/Nexus<VerionNumber>/SDK/<OS>/Python. If using Windows, you can install the package by running the included `.bat` file (i.e. `install_viconnexusapi.bat`).
Otherwise, navigate to the folder containing the package (i.e. viconnexusapi) and run `python -m pip install ./<package_name>`.


## Repo Structure
<pre>
.
|-- example_datasets            : contains example datasets for demo purposes
|   `-- shoe_stepping   
|-- logs                        : contains log files generated by the scripts
`-- mocap_popy                  : main package
    |-- aux_scripts                 : auxiliary scripts
    |-- config                      : package configuration
    |-- model_templates             : templates for generating models
    |   `-- json
    |-- models                      : data models
    |-- scripts                     : main scripts
    |   `-- unassign_rb_makers          
    `-- utils                       : utility functions
    
</pre>

## Main Scripts

### 1. `unassign_rb_makers.py`

This script unassigns maker labels from a subject in a Vicon Nexus trial using a RigidBody model. A RigidBody defines
the relationship between markers in a Vicon Skeleton (vsk) model through Segments (lines) and Joints (angles). 
The script calculates the difference in segments lengths and joint angles between a calibrated Rigid Body model and the 
Rigid Body at each frame in the trial. Alternatively, the script can compare the Rigid Body between successive frames.
The script scores each marker based on differences in segment lengths and joint angles, and unassigns markers with
scores above a set threshold. The script can be run 'online', where it connects to Vicon Nexus and processes the data in
the active trial, or 'offline', where it reads data from a C3D file.

This file can be integrated into a Vicon Nexus pipeline by running the script in 'online' mode.

To view usage information, run the following command:
```bash
python mocap_popy/scripts/unassign_rb_markers/unassign_rb_markers.py --help
```


## Contributing

When contributing to this repository, please first create a new branch (`git checkout -b <branch_name>`) and then submit a pull request. Assign the pull request to the repository owner for review.